<!DOCTYPE html><html class="appearance-auto" lang="zh-Hans"><head><meta charset="UTF-8"><title>52-zmap-45分钟即可全网ipv4端口</title><meta name="description" content="黑客常用工具"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '011aebf2f9f9f3201930e159bcd66b17';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://pic.imgdb.cn/item/6639fa110ea9cb14038250f2.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="ZMap：互联网扫描仪
ZMap 是一款快速单数据包网络扫描仪，专为互联网范围内的网络调查而设计。在具有千兆位以太网连接的典型台式计算机上，ZMap 能够在 45 分钟内扫描单个端口上的整个公共 IPv4 地址空间。通过 10gigE 连接和netmap或PF_RING，ZMap 可以在 5 分钟内扫描 IPv4 地址空间。
ZMap 可在 GNU/Linux、Mac OS 和 BSD 上运行。 ZMap目前已经完全实现了TCP SYN扫描、ICMP、DNS查询、UPnP、BACNET的探测模块，并且可以发送大量的UDP探测。如果您希望进行更多复杂的扫描（例如，横幅抓取或 TLS 握手），请查看ZGrab 2，它是 ZMap 的姊妹项目，它执行有状态的应用程序层握手。
使用 ZMap如果您以前没有使用过 Z.."><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="杨CC的小世界" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">疯狂的杨CC's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">52-zmap-45分钟即可全网ipv4端口</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">所有文章</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">所有文章</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ZMap%EF%BC%9A%E4%BA%92%E8%81%94%E7%BD%91%E6%89%AB%E6%8F%8F%E4%BB%AA"><span class="toc-text">ZMap：互联网扫描仪</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-ZMap"><span class="toc-text">使用 ZMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AD%91%E5%AD%A6"><span class="toc-text">建筑学</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%B8%E5%8F%AF%E5%92%8C%E7%89%88%E6%9D%83"><span class="toc-text">许可和版权</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97"><span class="toc-text">入门指南</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-1"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F%E6%89%AB%E6%8F%8F%E9%80%9F%E7%8E%87%E8%AD%A6%E5%91%8A"><span class="toc-text">⚠️扫描速率警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E2%9A%A0%EF%B8%8F%E7%BA%BF%E7%A8%8B%E8%AD%A6%E5%91%8A"><span class="toc-text">⚠️线程警告</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%89%AB%E6%8F%8F"><span class="toc-text">运行您的第一次扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA"><span class="toc-text">输出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E7%8E%B0"><span class="toc-text">表现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81-%E6%8E%A5%E6%94%B6%E8%A7%A3%E8%80%A6"><span class="toc-text">发送&#x2F;接收解耦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E9%AB%98%E5%8F%91%E9%80%81%E6%80%A7%E8%83%BD"><span class="toc-text">提高发送性能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BA%BF%E7%A8%8B%E5%8F%91%E9%80%81%E9%80%9F%E7%8E%87"><span class="toc-text">1 线程发送速率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E7%BA%BF%E7%A8%8B%E5%8F%91%E9%80%81%E9%80%9F%E7%8E%87"><span class="toc-text">4线程发送速率</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E9%AB%98%E6%89%AB%E6%8F%8F%E7%B2%BE%E5%BA%A6"><span class="toc-text">提高扫描精度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E5%92%8C%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%88%A0%E9%99%A4"><span class="toc-text">探测和重复数据删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E6%9C%9F%E6%9C%80%E5%A4%A7%E5%8F%91%E9%80%81%E9%80%9F%E7%8E%87"><span class="toc-text">预期最大发送速率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%89%AB%E6%8F%8F"><span class="toc-text">其他扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-N-%E4%B8%AA%E5%8F%AF%E8%BE%BE%E4%B8%BB%E6%9C%BA"><span class="toc-text">获取 N 个可达主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E7%8E%B0%E6%80%A7%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%90%9C%E7%B4%A2"><span class="toc-text">再现性和随机搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E7%AB%AF%E5%8F%A3"><span class="toc-text">多个端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%AD%90%E7%BD%91"><span class="toc-text">多个子网</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZMap-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">ZMap 的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#blocklist-conf"><span class="toc-text">blocklist.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zmap-conf"><span class="toc-text">zmap.conf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%82%A8%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%AD%E6%9F%A5%E6%89%BE%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">在您的安装中查找配置文件</span></a></li></ol></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90"><i class="tag post-item-tag">渗透工具推荐</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">52-zmap-45分钟即可全网ipv4端口</h1><time class="has-text-grey" datetime="2024-04-30T11:40:38.000Z">2024-04-30</time><article class="mt-2 post-content"><h1 id="ZMap：互联网扫描仪"><a href="#ZMap：互联网扫描仪" class="headerlink" title="ZMap：互联网扫描仪"></a>ZMap：互联网扫描仪</h1><p><a href="https://github.com/zmap/zmap/actions/workflows/cmake.yml/badge.svg"><img src="https://github.com/zmap/zmap/actions/workflows/cmake.yml/badge.svg" alt="构建状态"></a></p>
<p>ZMap 是一款快速单数据包网络扫描仪，专为互联网范围内的网络调查而设计。在具有千兆位以太网连接的典型台式计算机上，ZMap 能够在 45 分钟内扫描单个端口上的整个公共 IPv4 地址空间。通过 10gigE 连接和<a href="http://info.iet.unipi.it/~luigi/netmap/">netmap</a>或<a href="http://www.ntop.org/products/packet-capture/pf_ring/">PF_RING</a>，ZMap 可以在 5 分钟内扫描 IPv4 地址空间。</p>
<p>ZMap 可在 GNU/Linux、Mac OS 和 BSD 上运行。 ZMap目前已经完全实现了TCP SYN扫描、ICMP、DNS查询、UPnP、BACNET的探测模块，并且可以发送大量的<a href="https://github.com/zmap/zmap/blob/master/examples/udp-probes/README">UDP探测</a>。如果您希望进行更多复杂的扫描（例如，横幅抓取或 TLS 握手），请查看<a href="https://github.com/zmap/zgrab2">ZGrab 2</a>，它是 ZMap 的姊妹项目，它执行有状态的应用程序层握手。</p>
<h2 id="使用-ZMap"><a href="#使用-ZMap" class="headerlink" title="使用 ZMap"></a>使用 ZMap</h2><p>如果您以前没有使用过 ZMap，我们有一份分步入门<a href="https://github.com/zmap/zmap/wiki/Getting-Started-Guide">指南</a>，详细介绍了如何执行基本扫描。有关 ZMap 所有选项和更高级功能的文档可以在我们的<a href="https://github.com/zmap/zmap/wiki">GitHub Wiki</a>中找到。</p>
<p>如果您有疑问，请先查看我们的<a href="https://github.com/zmap/zmap/wiki/FAQ">常见问题解答</a>。还有疑问吗？在<a href="https://github.com/zmap/zmap/discussions/categories/q-a">Github 讨论</a>中询问社区。请不要针对使用或支持问题创建问题。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>ZMap 的最新稳定版本是版本<a href="https://github.com/zmap/zmap/releases/tag/v3.0.0">3.0.0</a>，支持 Linux、macOS 和 BSD。 ZMap <a href="https://github.com/zmap/zmap/releases/tag/v4.1.0-RC2">4.1.0-RC2</a>添加了对扫描多个端口的支持。</p>
<p><strong>从源代码构建 ZMap 的说明</strong>可以在<a href="https://github.com/zmap/zmap/blob/main/INSTALL.md">INSTALL</a>中找到。</p>
<p>blackarch中使用命令:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -Syu yay &amp;&amp; sudo yay -S zmap</span><br></pre></td></tr></tbody></table></figure>

<p>kali/parrot/debian系列安装命令:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install zmap</span><br></pre></td></tr></tbody></table></figure>

<p>centos/redhat系列安装命令</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y zmap</span><br></pre></td></tr></tbody></table></figure>



<h2 id="建筑学"><a href="#建筑学" class="headerlink" title="建筑学"></a>建筑学</h2><p>有关 ZMap 架构的更多信息以及与其他工具的比较可以在这两篇研究论文中找到：</p>
<ul>
<li><a href="https://zmap.io/paper.pdf">ZMap：快速互联网范围扫描及其安全应用</a></li>
<li><a href="https://jhalderm.com/pub/papers/zmap10gig-woot14.pdf">Zippier ZMap：10 Gbps 的互联网范围扫描</a></li>
</ul>
<p>如果您使用 ZMap 进行已发表的研究，请引用原始研究论文：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@inproceedings{durumeric2013zmap,</span><br><span class="line">  title={{ZMap}: Fast Internet-wide scanning and its security applications},</span><br><span class="line">  author={Durumeric, Zakir and Wustrow, Eric and Halderman, J Alex},</span><br><span class="line">  booktitle={22nd USENIX Security Symposium},</span><br><span class="line">  year={2013}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<p>引用 ZMap 论文有助于我们跟踪研究社区内的 ZMap 使用情况，并为持续开发寻求资金。</p>
<h2 id="许可和版权"><a href="#许可和版权" class="headerlink" title="许可和版权"></a>许可和版权</h2><p>ZMap 版权所有 2023 密歇根大学董事会</p>
<p>根据 Apache 许可证 2.0 版（“许可证”）获得许可；除非遵守许可证，否则您不得使用此文件。您可以在<a href="http://www.apache.org/licenses/LICENSE-2.0%E8%8E%B7%E5%8F%96%E8%AE%B8%E5%8F%AF%E8%AF%81%E5%89%AF%E6%9C%AC">http://www.apache.org/licenses/LICENSE-2.0获取许可证副本</a></p>
<p>除非适用法律要求或书面同意，否则根据许可证分发的软件均按“原样”分发，不带任何明示或暗示的保证或条件。请参阅许可证，了解许可证下管理权限和限制的特定语言。</p>
<h1 id="入门指南"><a href="#入门指南" class="headerlink" title="入门指南"></a>入门指南</h1><p><a href="https://github.com/zmap/zmap/wiki/Getting-Started-Guide/_edit">编辑</a> <a href="https://github.com/zmap/zmap/wiki/_new">新一页</a></p>
<p>菲利普·斯蒂芬斯编辑了此页面3周前 · <a href="https://github.com/zmap/zmap/wiki/Getting-Started-Guide/_history">19次修订</a></p>
<p>边做边学最好？想要一些指导示例来演示使用 ZMap 进行基本扫描以入门吗？这是开始的地方！ ZMap 团队创建本指南是为了帮助新手习惯扫描，但如果仍有不清楚的地方，请随时在我们的<a href="https://github.com/zmap/zmap/discussions">Github 讨论</a>中提问。</p>
<p>我们将介绍：</p>
<ul>
<li>安装 ZMap</li>
<li>运行第一次扫描</li>
<li>定向输出</li>
<li>表现</li>
<li>其他扫描类型</li>
<li>默认阻止的子网</li>
<li>更多资源</li>
</ul>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>ZMap 可通过许多常见的包管理器获得，或者您也可以从源代码进行编译。完整说明可<a href="https://github.com/zmap/zmap/blob/main/INSTALL.md">在此处</a>获取。要检查您是否已正确安装所有内容，请运行<code>zmap --version</code>.目前我们建议使用版本 4.1.0-RC2。</p>
<h2 id="⚠️扫描速率警告"><a href="#⚠️扫描速率警告" class="headerlink" title="⚠️扫描速率警告"></a>⚠️扫描速率警告</h2><p>默认情况下，ZMap 将以您的网卡允许的速度进行扫描。由于 ZMap 直接组成以太网帧，因此它没有任何拥塞控制的概念（就像 TCP 默认情况下那样）。这有两个潜在的陷阱：</p>
<ul>
<li><em>目标网络 DoS：</em>如果您以非常高的速率扫描小型子网（例如，单个组织），您很容易意外地对目标网络进行 DOS。我们建议<em>不要</em>以 1Gbps 或更快的速度运行扫描，除非您要扫描整个互联网。如果您扫描单个网络，则以接近 10Mbps 的速率运行会更成功。</li>
<li><em>源网络过载：</em>无论您扫描多少台主机，您都可能面临<em>源</em>网络（即用于扫描 Internet 的网络）过载的风险。许多仅通告<em>吞吐量</em>数字（例如 1Gbps）的网络设备无法使用最小大小的数据包来处理全速（因为这需要处理设备的理论每秒最大数据包速率。）</li>
</ul>
<p>为了减少对目标网络的影响，ZMap 以随机顺序扫描范围内的 IP 地址。这意味着给定时间段内目标子网上的负载取决于 ZMap 的扫描速率和目标范围的大小。</p>
<p><img src="https://private-user-images.githubusercontent.com/23459798/288224881-8642008a-df16-40ac-a7ec-d9389964e7b3.gif?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ0NjQ0OTEsIm5iZiI6MTcxNDQ2NDE5MSwicGF0aCI6Ii8yMzQ1OTc5OC8yODgyMjQ4ODEtODY0MjAwOGEtZGYxNi00MGFjLWE3ZWMtZDkzODk5NjRlN2IzLmdpZj9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA0MzAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNDMwVDA4MDMxMVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWMyM2U1MWQ0MDU4MWI0YmY1ZmM5ODk0YWIzNjA4ZTc5NmU1NTgzZDYxNDUzOTgyNDg2YmNjOGNiNTVlOTNlMTAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.iQ0ZNY5fL4LEUqZ5yCrWVzKPK4naw-G0HqqzIqn4McU" alt="目标子网负载"></p>
<p>在上图中，正在扫描的不同子网由彩色线表示。因此，如果扫描的目标较大，“良好”的扫描速率可能会更快，因为负载更加分散。</p>
<p>这不仅关系到成为无私的互联网公民，目标网络超载可能会导致：</p>
<ol>
<li>网络管理员封锁你的IP</li>
<li>路由器丢弃您的扫描数据包</li>
<li>剥夺其他 LAN 用户的互联网带宽</li>
</ol>
<p>#1 和 #2 都会导致扫描结果不准确，因为无法区分扫描无响应是由于不存在主机、防火墙阻止您的 IP 还是由于途中丢失数据包。更多详细信息，请参阅“提高扫描精度”部分。</p>
<p>我们在给定示例中根据扫描目标的大小列出了我们认为合理的带宽/探头节流参数，但一个好的经验法则是以特定应用程序所需的最慢速率进行扫描。</p>
<h2 id="⚠️线程警告"><a href="#⚠️线程警告" class="headerlink" title="⚠️线程警告"></a>⚠️线程警告</h2><p>ZMap CLI 提供了使用 来设置发送线程数量的功能<code>-T number_of_threads</code>。还会创建用于接收数据包和监视扫描进度的线程，因此 ZMap 所需的线程数就是<code>2 + T</code>其中 T 是您设置的线程数（默认为 4，除非主机的核心数 &lt; 4）。</p>
<p>作为一般规则，我们建议坚持 &lt;= 8 个发送线程，因为我们发现在此之后性能趋于稳定。此外，使用非常大的线程数 (&gt; 32) 不会<em>提高</em>扫描性能，并且可能会导致您遇到数据包发送问题或遇到数据包丢失，从而导致扫描结果不准确。</p>
<p>需要明确的是，创建比机器上的内核数量更多的线程的好处为零。发送线程都尽可能快地发送，并且增加线程超过核心数量将导致核心争用。</p>
<p>提示</p>
<p>与扫描速率一样，我们建议从较低的速率开始，然后根据需要增加，以确保扫描准确并最大限度地减少主机和网络压力。</p>
<h2 id="运行您的第一次扫描"><a href="#运行您的第一次扫描" class="headerlink" title="运行您的第一次扫描"></a>运行您的第一次扫描</h2><p>让我们开始第一次扫描。我们将通过端口 80 向<code>TCP SYN</code>子网中的所有 IP 发送一个数据包<code>171.67.70.0/23</code>，数据包发送速率为每秒 128 个数据包。如果该 IP/端口对上有任何运行，我们应该会收到一个<code>SYN ACK</code>数据包作为回复。</p>
<p>运行以下命令：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 -r 128 171.67.70.0/23</span><br></pre></td></tr></tbody></table></figure>

<p>您应该得到一些类似于以下内容的输出：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">171.67.71.204</span><br><span class="line">171.67.71.128</span><br><span class="line">171.67.70.245</span><br><span class="line">171.67.71.191</span><br><span class="line">171.67.71.186</span><br><span class="line">171.67.71.202</span><br><span class="line">171.67.70.240</span><br><span class="line">171.67.70.242</span><br><span class="line">171.67.71.192</span><br><span class="line"> 0:05 42% (7s left); send: 512 done (127 p/s avg); recv: 91 17 p/s (17 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line"> 0:06 50% (6s left); send: 512 done (127 p/s avg); recv: 91 0 p/s (15 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line"> 0:07 59% (5s left); send: 512 done (127 p/s avg); recv: 91 0 p/s (12 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line"> 0:08 67% (4s left); send: 512 done (127 p/s avg); recv: 91 0 p/s (11 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line"> 0:09 75% (3s left); send: 512 done (127 p/s avg); recv: 91 0 p/s (10 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line"> 0:10 84% (2s left); send: 512 done (127 p/s avg); recv: 91 0 p/s (9 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line"> 0:11 92% (1s left); send: 512 done (127 p/s avg); recv: 91 0 p/s (8 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.77%</span><br><span class="line">Dec 05 22:29:12.352 [INFO] zmap: completed</span><br></pre></td></tr></tbody></table></figure>



<blockquote>
<p><strong>故障排除</strong></p>
<p>ZMap 非常擅长告诉您它遇到的任何问题。一些常见的包括：</p>
<ol>
<li>您的用户可能无权捕获默认接口上的流量，除非您使用<code>sudo</code>.</li>
<li>如果有多个网络适配器可供选择，您可能需要指定您的 MAC 地址。如果您看到类似的情况，请<code>--source-mac=XX:XX:XX:XX:XX:XX</code>在您运行的任何 ZMap 命令中使用该标志。</li>
<li>第一次运行 ZMap 时，ZMap 可能会提到<code>zmap: could not detect GW MAC address...</code>.按照其指示运行命令<code>curl zmap.io</code>，这应该初始化 GW MAC 地址，以便 ZMap 可以正确路由流量。</li>
</ol>
<p>如果您按照说明操作，使用的是受支持的操作系统，但<em>仍然遇到问题，请通过</em><a href="https://github.com/zmap/zmap/discussions">Github 讨论</a>与我们联系！</p>
</blockquote>
<p>我们可以在这里看到两种类型的输出：</p>
<ol>
<li>响应我们的<code>SYN</code>数据包的 IP</li>
<li>每秒打印详细的扫描状态（完成百分比、剩余秒数、发送/接收速率……）</li>
</ol>
<p>我们确实说过“输出类似于”，这提出了一个关键点，您的结果可能会略有不同。可访问 Internet 的主机可以在扫描之间打开/离线，并且您的硬件可能比我们正在运行的硬件更快/更慢。</p>
<p>将所有输出显示在一个屏幕中固然很好，但您可能希望将 IP/端口命中和状态信息分开。</p>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p><code>-o</code>or标志<code>--output-file</code>允许我们指定 IP/端口对命中的位置。尝试<code>-o</code>像这样使用该标志：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 -o "output.csv" -r 128 171.67.70.0/23</span><br></pre></td></tr></tbody></table></figure>



<p>您应该得到类似于以下内容的输出：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Dec 05 21:52:43.347 [INFO] zmap: By default, ZMap will output the unique IP addresses of hosts that respond successfully (e.g., SYN-ACK packet). This is equivalent to running ZMap with the following flags: --output-module=csv --output-fields=saddr --output-filter='success=1 &amp;&amp; repeat=0' --no-header-row. If you want all responses, explicitly set an output module or set --output-filter="".</span><br><span class="line">Dec 05 21:52:43.348 [INFO] dedup: Response deduplication method is full</span><br><span class="line">Dec 05 21:52:43.406 [INFO] recv: duplicate responses will be excluded from output</span><br><span class="line">Dec 05 21:52:43.406 [INFO] recv: unsuccessful responses will be excluded from output</span><br><span class="line"> 0:00 0%; send: 1 1 p/s (22 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line"> 0:00 0%; send: 1 0 p/s (22 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line"> 0:01 9%; send: 134 133 p/s (128 p/s avg); recv: 22 22 p/s (21 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 16.42%</span><br><span class="line"> 0:02 17%; send: 263 129 p/s (128 p/s avg); recv: 22 0 p/s (10 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 8.37%</span><br><span class="line"> 0:03 25%; send: 391 128 p/s (128 p/s avg); recv: 51 29 p/s (16 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 13.04%</span><br><span class="line"> 0:04 34%; send: 512 done (128 p/s avg); recv: 74 23 p/s (18 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 14.45%</span><br><span class="line"> 0:05 42% (7s left); send: 512 done (128 p/s avg); recv: 90 16 p/s (17 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line"> 0:06 50% (6s left); send: 512 done (128 p/s avg); recv: 90 0 p/s (14 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line"> 0:07 59% (5s left); send: 512 done (128 p/s avg); recv: 90 0 p/s (12 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line"> 0:08 67% (4s left); send: 512 done (128 p/s avg); recv: 90 0 p/s (11 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line"> 0:09 75% (3s left); send: 512 done (128 p/s avg); recv: 90 0 p/s (9 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line"> 0:10 84% (2s left); send: 512 done (128 p/s avg); recv: 90 0 p/s (8 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line"> 0:11 92% (1s left); send: 512 done (128 p/s avg); recv: 90 0 p/s (8 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 17.58%</span><br><span class="line">Dec 05 21:52:55.412 [INFO] zmap: completed</span><br></pre></td></tr></tbody></table></figure>



<p>新<code>output.csv</code>文件（位于运行扫描的文件夹中）现在应该包含在端口 80 上响应的所有 IP，并且我们<code>stdout</code>只会向我们显示扫描的状态，很好！</p>
<h2 id="表现"><a href="#表现" class="headerlink" title="表现"></a>表现</h2><p>ZMap 的一大卖点是它调查大型子网的速度。在千兆位以太网连接上，可以在 40 分钟内勘察单个端口上的整个 IPv4 空间！让我们讨论一下影响性能的各种因素。为此，我们需要更多地了解 ZMap 的运作方式。</p>
<h3 id="发送-接收解耦"><a href="#发送-接收解耦" class="headerlink" title="发送/接收解耦"></a>发送/接收解耦</h3><p>为了获得如此高性能，ZMap 在设计上是无状态的。这意味着一个/多个发送线程发送数据包，一个/多个接收线程记录任何回复，但没有线程间通信。正是由于缺乏通信/锁定，ZMap 才具有如此高的性能。它还有助于解释我们上面看到的输出。子网 ( <code>/23</code>) 有 512 个 IP，加上每秒 128 个数据包的扫描速率 ( <code>p/s</code>)，探测数据包（<code>SYN</code>默认为 TCP 数据包）的发送在 4 秒内结束。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0:04 34%; send: 512 done (128 p/s avg); recv: 74 23 p/s (18 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 14.45%</span><br></pre></td></tr></tbody></table></figure>



<p>默认情况下，接收线程在发送线程完成发送后等待 8 秒以等待任何<code>SYN ACK</code>数据包。我们发现 8 秒在等待<code>SYN ACK</code>来自远程主机的潜在慢速和等待时间不长以致回报递减之间取得了良好的平衡。根据您的需要，您可能希望使用 修改此值<code>--cooldown-time=10</code>。这将迫使接收线程等待 10 秒以接收任何落后的数据包。</p>
<p>请注意，在我们上面捕获的输出中，命中率在 后没有增加（至少在百分之一的粒度上）<code>0:05</code>，因此请记住收益递减。</p>
<h3 id="提高发送性能"><a href="#提高发送性能" class="headerlink" title="提高发送性能"></a>提高发送性能</h3><p>我们在上面的部分中介绍了接收线程将等待的恒定时间<code>SYN ACK</code>，<code>--cooldown-time</code>但这并没有解决发送的速率<code>SYN</code>。在较大的扫描中，这是将主导扫描运行时间的组件。</p>
<p>有了足够大的目标范围，就不用担心目标子网过载。为了进一步提高性能，我们需要添加更多线程。使用该<code>--sender-threads=N</code>标志来执行此操作：</p>
<h4 id="1-线程发送速率"><a href="#1-线程发送速率" class="headerlink" title="1 线程发送速率"></a><strong>1 线程发送速率</strong></h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 -o "output.csv" -B 1G --sender-threads=1 171.67.70.0/2</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0:00 0%; send: 211 1 p/s (3.69 Kp/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">0:00 0%; send: 400 274 Kp/s (6.92 Kp/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">0:01 0%; send: 505473 505 Kp/s (478 Kp/s avg); recv: 5176 5.17 Kp/s (4.89 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.02%</span><br><span class="line">0:02 0%; send: 1113056 607 Kp/s (541 Kp/s avg); recv: 12962 7.78 Kp/s (6.30 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.16%</span><br><span class="line">0:03 0%; send: 1726996 614 Kp/s (565 Kp/s avg); recv: 20562 7.60 Kp/s (6.72 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.19%</span><br><span class="line">0:04 0%; send: 2335833 609 Kp/s (575 Kp/s avg); recv: 28571 8.01 Kp/s (7.04 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.22%</span><br><span class="line">0:05 0% (30m left); send: 2943829 608 Kp/s (582 Kp/s avg); recv: 36420 7.85 Kp/s (7.20 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.24%</span><br><span class="line">0:06 0% (30m left); send: 3550851 607 Kp/s (586 Kp/s avg); recv: 44122 7.70 Kp/s (7.28 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.24%</span><br><span class="line">0:07 0% (30m left); send: 4156961 606 Kp/s (589 Kp/s avg); recv: 52047 7.92 Kp/s (7.37 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.25%</span><br><span class="line">0:08 0% (30m left); send: 4756743 600 Kp/s (590 Kp/s avg); recv: 59834 7.79 Kp/s (7.42 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.26%</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>



<h4 id="4线程发送速率"><a href="#4线程发送速率" class="headerlink" title="4线程发送速率"></a><strong>4线程发送速率</strong></h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 -o "output.csv" -B 1G --sender-threads=4 171.67.70.0/2</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0:00 0%; send: 360 1 p/s (5.31 Kp/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">0:00 0%; send: 586 388 Kp/s (8.58 Kp/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">0:01 0%; send: 1125395 1.12 Mp/s (1.05 Mp/s avg); recv: 11804 11.8 Kp/s (11.0 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.05%</span><br><span class="line">0:02 0%; send: 2401617 1.28 Mp/s (1.16 Mp/s avg); recv: 28248 16.4 Kp/s (13.7 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.18%</span><br><span class="line">0:03 0%; send: 3667077 1.27 Mp/s (1.19 Mp/s avg); recv: 44305 16.1 Kp/s (14.4 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.21%</span><br><span class="line">0:04 0%; send: 4932812 1.27 Mp/s (1.21 Mp/s avg); recv: 60886 16.6 Kp/s (15.0 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.23%</span><br><span class="line">0:05 1% (14m left); send: 6193698 1.26 Mp/s (1.22 Mp/s avg); recv: 77131 16.2 Kp/s (15.2 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.25%</span><br><span class="line">0:06 1% (14m left); send: 7452466 1.26 Mp/s (1.23 Mp/s avg); recv: 93092 16.0 Kp/s (15.3 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.25%</span><br><span class="line">0:07 1% (14m left); send: 8713445 1.26 Mp/s (1.23 Mp/s avg); recv: 109494 16.4 Kp/s (15.5 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.26%</span><br><span class="line">0:08 1% (14m left); send: 9970806 1.26 Mp/s (1.24 Mp/s avg); recv: 125807 16.3 Kp/s (15.6 Kp/s avg); drops: 0 p/s (0 p/s avg); hitrate: 1.26%</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>



<p>我们可以看到，增加发送线程的数量提高了数据包发送速率，因此减少了运行时间（预期运行时间为 30 分钟，而预期运行时间为 14 分钟）。对于大多数用途，单个线程可能就足够了，但如果您需要提高性能、拥有高带宽上行链路，并且要扫描大部分 IPv4 空间，则可以使用该线程。</p>
<h2 id="提高扫描精度"><a href="#提高扫描精度" class="headerlink" title="提高扫描精度"></a>提高扫描精度</h2><p>ZMap 将以 的速率发送数据包<code>min(max rate your Network Interface Card (NIC) can sustain, the rate you specify with CLI flags)</code>。该速率<em>可能</em>高于您的 LAN 或目标子网的处理能力，从而导致数据包丢失和扫描结果不精确。</p>
<p>删除的<code>SYN</code>或<code>SYN ACK</code>将在 ZMap 中显示为相同，就好像根本不存在主机一样。由于 ZMap 直接组成以太网帧，因此无法保证交付。考虑到这一点，您可能希望降低<code>--rate=pps</code>或<code>--bandwidth=bps</code>确定您的命中率是否保持一致（表明您没有看到大量丢包/漏报）。另一种选择是增加<code>--probes=N (default = 1)</code>. “探测”是 ZMap 术语，指的是 ZMap 发送到潜在主机的数据包，您可以对每个 IP/端口对使用多个探测来尝试解决数据包丢失的情况。</p>
<h3 id="探测和重复数据删除"><a href="#探测和重复数据删除" class="headerlink" title="探测和重复数据删除"></a>探测和重复数据删除</h3><p>如上一节所述，您可能希望增加计数<code>--probes=N</code>以减少扫描中出现假阴性的可能性。然而，由于 ZMap 是无状态的，它如何防止给定 IP if<code>--probes=N</code>和 的多个日志<code>N &gt; 1</code>？</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 --probes=5 -B 100M --dedup-method=none 171.67.70.0/10</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> 0:00 0%; send: 42 1 p/s (821 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">171.67.224.74</span><br><span class="line">171.67.224.74</span><br><span class="line">171.67.224.74</span><br><span class="line">171.67.224.74</span><br><span class="line">171.67.224.74</span><br><span class="line">171.67.35.131</span><br><span class="line">171.67.35.131</span><br><span class="line">171.67.35.131</span><br><span class="line">171.67.35.131</span><br><span class="line">171.67.35.131</span><br><span class="line">171.67.7.61</span><br><span class="line">171.67.7.61</span><br><span class="line">171.67.7.61</span><br><span class="line">171.67.7.61</span><br><span class="line">171.67.7.61</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>



<p>每次响应探测时，都会记录下来。默认情况下，<code>--dedup-method=window</code>窗口大小为1M。这意味着 ZMap 将跟踪内存中最后 1M 探测响应，以避免多次记录命中。您可以使用<code>--dedup-method=full</code>，但要了解内存需求将随着扫描空间的大小而增加。</p>
<blockquote>
<p>注意：我们已经说过 ZMap 是无状态的，但在这里我们似乎与该声明相矛盾，提到存储最后 1M 探测响应😄。 ZMap 在发送线程和接收线程之间是无状态的，但 ZMap 的接收线程可以保存状态以免记录重复项。</p>
</blockquote>
<h3 id="预期最大发送速率"><a href="#预期最大发送速率" class="headerlink" title="预期最大发送速率"></a>预期最大发送速率</h3><p>在我们的实验室环境中，具有 1 Gbit 有线以太网的现成 Ubuntu 虚拟机每秒可处理多达 1.3-145 万个数据包。使用无线连接、低端硬件或 LAN 带宽争用都可能对您的性能产生负面影响。</p>
<h2 id="其他扫描"><a href="#其他扫描" class="headerlink" title="其他扫描"></a>其他扫描</h2><h3 id="获取-N-个可达主机"><a href="#获取-N-个可达主机" class="headerlink" title="获取 N 个可达主机"></a>获取 N 个可达主机</h3><p>在前面的示例 ( <code>sudo zmap -p 80 -o "output.csv" -B 1G --sender-threads=4 171.67.70.0/2</code>) 中，我们使用了给定的子网。然而，也许您只想在 IPv4 空间中获得 10 个可访问的主机。您可以使用<code>--max-results=10</code>或<code>-N 10</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 -B 100M -N 10</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 0:00 0%; send: 0 0 p/s (0 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line"> 0:00 0%; send: 0 0 p/s (0 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">104.252.154.129</span><br><span class="line">207.241.227.232</span><br><span class="line">34.102.143.17</span><br><span class="line">185.227.252.87</span><br><span class="line">88.218.93.178</span><br><span class="line">206.54.174.210</span><br><span class="line">50.3.14.225</span><br><span class="line">34.43.9.190</span><br><span class="line">184.84.170.239</span><br><span class="line">154.37.15.2</span><br><span class="line">Dec 05 22:19:22.112 [INFO] zmap: completed</span><br></pre></td></tr></tbody></table></figure>



<h3 id="再现性和随机搜索"><a href="#再现性和随机搜索" class="headerlink" title="再现性和随机搜索"></a>再现性和随机搜索</h3><p>再次运行上面的命令…</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 -B 100M -N 10</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 0:00 0%; send: 0 0 p/s (0 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line"> 0:00 0%; send: 17 62.7 Kp/s (305 p/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">206.2.159.123</span><br><span class="line">47.251.50.46</span><br><span class="line">144.49.230.210</span><br><span class="line">34.220.245.127</span><br><span class="line">34.160.175.57</span><br><span class="line">216.180.232.245</span><br><span class="line">20.94.252.204</span><br><span class="line">172.65.73.3</span><br><span class="line">38.173.125.213</span><br><span class="line">172.67.201.97</span><br><span class="line">Dec 05 22:33:37.695 [INFO] zmap: completed</span><br></pre></td></tr></tbody></table></figure>



<p>这很有趣，我们得到了一组完全不同的 IP！当您定义给定的搜索空间时，ZMap 会随机而不是线性地扫描它。当我们想要像之前的扫描一样搜索整个搜索空间时，这并不是什么大问题，因为我们最终仍然会得到相同的（无序的）结果集。然而，在这种情况下，ZMap 在给定搜索空间中找到前 10 个命中时返回。 ZMap 的随机搜索模式导致输出出现这种差异。</p>
<p>为什么要随机搜索？发送端和接收端都可能发生资源争用。我们希望尽可能分散放置在接收子网上的负载，因此通过随机搜索搜索空间，我们可以分散在给定时间放置在给定网络上的负载。</p>
<p>您可能希望扫描顺序具有可重复性，因此您可以使用 来<code>--seed=n</code>确保后续运行使用相同的顺序。</p>
<h3 id="多个端口"><a href="#多个端口" class="headerlink" title="多个端口"></a>多个端口</h3><blockquote>
<p>ZMap v.4.0.0 中添加</p>
</blockquote>
<p>您可以扫描多个端口。在这种情况下，ZMap 将向<code>SYN</code>每个 IP/端口对发送 TCP数据包。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 22,80 -B 100M -N 10 171.67.70.0/10</span><br></pre></td></tr></tbody></table></figure>



<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> 0:00 0%; send: 824 1 p/s (10.7 Kp/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line"> 0:00 0%; send: 1163 623 Kp/s (15.0 Kp/s avg); recv: 0 0 p/s (0 p/s avg); drops: 0 p/s (0 p/s avg); hitrate: 0.00%</span><br><span class="line">125.6.184.89,80</span><br><span class="line">125.6.189.199,80</span><br><span class="line">125.62.85.202,22</span><br><span class="line">125.62.86.43,22</span><br><span class="line">125.103.118.1,22</span><br><span class="line">125.135.32.198,80</span><br><span class="line">125.136.125.185,80</span><br><span class="line">125.140.210.154,80</span><br><span class="line">125.143.130.34,80</span><br><span class="line">125.137.239.225,80</span><br><span class="line">Nov 28 23:15:06.878 [INFO] zmap: completed</span><br></pre></td></tr></tbody></table></figure>



<h3 id="多个子网"><a href="#多个子网" class="headerlink" title="多个子网"></a>多个子网</h3><p>您也可以使用同一扫描来扫描多个子网。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zmap -p 80 10.0.0.0/8 192.168.0.0/16 (scan both subnets on TCP/80)</span><br></pre></td></tr></tbody></table></figure>



<h2 id="ZMap-的配置文件"><a href="#ZMap-的配置文件" class="headerlink" title="ZMap 的配置文件"></a>ZMap 的配置文件</h2><p>默认情况下，ZMap 不会扫描<em>整个</em>IPv4 空间。有两个文件包含默认情况下不扫描的子网。您可以更改这些文件以显式扫描这些范围，但是在每种情况下，默认情况下不扫描它们都是有原因的。</p>
<h3 id="blocklist-conf"><a href="#blocklist-conf" class="headerlink" title="blocklist.conf"></a><code>blocklist.conf</code></h3><p><code>blocklist.conf</code>包括 RFC 定义的子网（例如多播、保留/未分配的<a href="https://tools.ietf.org/html/rfc1918">RFC 1918 ，默认情况下不扫描这些子网。如果您不希望扫描某些 IP/子网，可以添加到此文件。</a></p>
<h3 id="zmap-conf"><a href="#zmap-conf" class="headerlink" title="zmap.conf"></a><code>zmap.conf</code></h3><p>如果您发现自己指定了某些设置，例如每次运行 ZMap 时的最大带宽或黑名单文件，您可以在其中指定这些设置<code>/etc/zmap/zmap.conf</code>或使用自定义配置文件。</p>
<h3 id="在您的安装中查找配置文件"><a href="#在您的安装中查找配置文件" class="headerlink" title="在您的安装中查找配置文件"></a>在您的安装中查找配置文件</h3><p><em>您通常</em>可以在安装中找到这些文件，位置为<code>/etc/zmap/...conf</code>。</p>
<p>如果您使用包管理器安装 ZMap，它可能已将配置文件安装在其自己的位置。</p>
<p>例如，<code>homebrew</code>将配置文件安装在<code>/opt/homebrew/etc/zmap/</code>.如果您无法找到这些文件，请尝试<code>sudo find . -name "blocklist.conf" -maxdepth 5</code>在安装 ZMap 后从根目录运行。</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2024/05/01/53-nacs-%E8%87%AA%E5%8A%A8%E6%89%AB%E6%8F%8F%E5%B9%B6%E4%B8%94%E5%88%A9%E7%94%A8%E6%BC%8F%E6%B4%9E/" title="53-nacs-自动扫描并且利用漏洞"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: 53-nacs-自动扫描并且利用漏洞</span></a><a class="button is-default" href="/2024/04/29/51-%E8%87%AA%E5%8A%A8%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8Dip%E5%92%8Cip%E4%BF%A1%E6%81%AF/" title="51-自动解析A记录"><span class="has-text-weight-semibold">Next: 51-自动解析A记录</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/Sgyling"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> 疯狂的杨CC 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>